# cl-swagger-codegen #
lisp code-generator for swagger

A swagger codegen is to build APIs quicker and improve consumption of your Swagger-defined APIs in every popular language with Swagger Codegen. (http://swagger.io/swagger-codegen/)

cl-swagger-codegen generates API client for common lisp. 

## requirement libraries ##
please check that your system has these libraries :
```
(ql:quickload "cl-mustache")
(ql:quickload "drakma")
(ql:quickload "cl-json")
(ql:quickload "cl-ppcre")
```

_notice_
If your machine is MacOS, you need to check openssl version. It might be `OpenSSL 0.9.8`. 

```
openssl version
OpenSSL 0.9.8zh 14 Jan 2016
```
You need to install `openssl 1.0.x` by yourself because `drakma` use `cl+ssl` for TLS protocol that is only support `openssl 1.0.x`. 

And chage the path of `/quicklisp/dists/quicklisp/software/cl+ssl-20170403-git/src/reload.lisp`.
```
(:darwin (:or "libssl.dylib" "/usr/local/lib/libssl.dylib"))
```

## Generate Client Code ##


### From swagger url ###
You can build a client, (for example `test1.lisp`) against the swagger url as follows:

```
(generate-client "http://petstore.swagger.io/v2/swagger.json" "test1.lisp")
```

let's find `pets-pet` function in test1.lisp created by `generate-client`.

```
;;
;; summary : Updates a pet in the store with form data
;; description : 
;; * path : /PET/{PET-ID}
;;
(defun post-pet (urlpath &key content basic-authorization)
    (multiple-value-bind (stream code header)
      (drakma:http-request urlpath :basic-authorization basic-authorization :accept "application/json" :content-type "application/json" :content content :want-stream t :method :POST)
      (if (equal code 200) (progn (setf (flexi-streams:flexi-stream-external-format stream) :utf-8)
                                  (cl-json:decode-json stream))
          (format t "failed - code : ~a" code))))

```

### From swagger json file ###
You can build a client, (for example `test2.lisp`) against the swagger json file located path "./mapr.json" :

```
(generate-client #p"./mapr.json" "test2.lisp")
```

let's find `get-alarm-name` created by `generate-cleint`.

```
;;
;; summary : Displays a list of alarm names. Permissions required: login
;; description : 
;; * path : /ALARM/NAMES
;;
(defun get-alarm-names (urlpath &key content basic-authorization)
    (multiple-value-bind (stream code header)
      (drakma:http-request urlpath :basic-authorization basic-authorization :accept "application/json" :content-type "application/json" :content content :want-stream t :method :GET)
      (if (equal code 200) (progn (setf (flexi-streams:flexi-stream-external-format stream) :utf-8)
                                  (cl-json:decode-json stream))
          (format t "failed - code : ~a" code))))

```

## call APIs ##


For example, from the client generated by cl-swagger-codegen, you can add a new pet to the store as follows: 
We are using `cl-json` (https://common-lisp.net/project/cl-json/) to edit json structure. 

```
 (post-pet "http://petstore.swagger.io/v2/pet"
     :content (cl-json:encode-json-to-string '((id . 0)
                                              (:category . ((:id . 0) (:name . "string")))
                                              (:name . "doggie")
                                              ("photoUrls" . #("string"))
                                              (:tags . (((:id . 0)
                                              (:name . "string"))))
                                              (:status . "available"))))
                                            
                                            
 => ((:ID . 9072482292157004079) (:CATEGORY (:ID . 0) (:NAME . "string")) (:NAME . "doggie") (:PHOTO-URLS "string") (:TAGS ((:ID . 0) (:NAME . "string"))) (:STATUS . "available"))

```

When the rest api require basic authorization, you can use.

```
 (get-alarm-list "https://localhost:8443/rest/alarm/list?summary=1" :basic-authorization '("mapr" "mapr"))
```

For json object, cl-swagger-codegen uses `cl-json`. 

```
(cl-json:encode-json-to-string '((id . 0)
                                (:category . ((:id . 0) (:name . "string")))
                                (:name . "doggie")
                                ("photoUrls" . #("string"))
                                (:tags . (((:id . 0)
                                (:name . "string"))))
                                (:status . "available")))
```

for json object :

```
{
  "id": 0,
  "category": {
    "id": 0,
    "name": "string"
  },
  "name": "doggie",
  "photoUrls": [
    "string"
  ],
  "tags": [
    {
      "id": 0,
      "name": "string"
    }
  ],
  "status": "available"
}
```
