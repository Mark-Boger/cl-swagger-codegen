# cl-swagger-codegen #
## Introduction
This project is for lisp swagger code-generator.

A swagger codegen is to build APIs quicker and improve consumption of your Swagger-defined APIs in every popular language with Swagger Codegen. (http://swagger.io/swagger-codegen/)

With cl-swagger-codegen, you can generates client stub code of common lisp. 

## Install/Build
`cl-swagger-codegen` can be installed by quicklisp. 

- Download source code
```
https://github.com/incjung/cl-swagger-codegen.git
```

- Load/build in REPL session
```
(swank:operate-on-system-for-emacs "cl-swagger" (quote load-op))
```


## Generate Client Stub Code ##


### Generating client stub lisp code from swagger url ###

"http://petstore.swagger.io/" is a sample server Petstore server like "hello world" code. :)

With this page, you can generate a client stub code in current working directory, for example `./client1.lisp`

```
(generate-client "http://petstore.swagger.io/v2/swagger.json" "client1.lisp")
```

Then, let's find the `client1.lisp` file. 
Open the `client1.lisp` and find a `pets-pet` definition:

```
;;
;; summary : Updates a pet in the store with form data
;; description : 
;; * path : /PET/{PET-ID}
;;
(defun post-pet (urlpath &key content basic-authorization)
    (multiple-value-bind (stream code header)
      (drakma:http-request urlpath :basic-authorization basic-authorization :accept "application/json" :content-type "application/json" :content content :want-stream t :method :POST)
      (if (equal code 200) (progn (setf (flexi-streams:flexi-stream-external-format stream) :utf-8)
                                  (cl-json:decode-json stream))
          (format t "failed - code : ~a" code))))

```

### Generating client stub lisp code from swagger json file ###

Without running server providing a swagger json url, if you have a `swagger json file`, you can build a client stub,too.
Assuming you have a swagger file, for example, `swagger.json`, you can generate a client stub code. 

```
(generate-client #p"./swagger.json" "client2.lisp")
```

## Calling a function of generated client stub code ##

### Usage 1
For example, from the client generated by cl-swagger-codegen, you can add a new pet to the store as follows: 
We are using `cl-json` (https://common-lisp.net/project/cl-json/) to edit json structure. 

```
 (post-pet "http://petstore.swagger.io/v2/pet"
     :content (cl-json:encode-json-to-string '((id . 0)
                                              (:category . ((:id . 0) (:name . "string")))
                                              (:name . "doggie")
                                              ("photoUrls" . #("string"))
                                              (:tags . (((:id . 0)
                                              (:name . "string"))))
                                              (:status . "available"))))
                                            
                                            
 => ((:ID . 9072482292157004079) (:CATEGORY (:ID . 0) (:NAME . "string")) (:NAME . "doggie") (:PHOTO-URLS "string") (:TAGS ((:ID . 0) (:NAME . "string"))) (:STATUS . "available"))

```

### Usage 2

When the rest api require basic authorization, you can use. `:basic-authorization`

```
 (<function-Name> <URL-PATH> :basic-authorization '("id" "password"))
```

For json object, cl-swagger-codegen uses `cl-json`. 

```
(cl-json:encode-json-to-string '((id . 0)
                                (:category . ((:id . 0) (:name . "string")))
                                (:name . "doggie")
                                ("photoUrls" . #("string"))
                                (:tags . (((:id . 0)
                                (:name . "string"))))
                                (:status . "available")))
```

for json object:

```
{
  "id": 0,
  "category": {
    "id": 0,
    "name": "string"
  },
  "name": "doggie",
  "photoUrls": [
    "string"
  ],
  "tags": [
    {
      "id": 0,
      "name": "string"
    }
  ],
  "status": "available"
}
```

## google open api service 
We can get google open APIs from https://github.com/APIs-guru/openapi-directory/tree/master/APIs/googleapis.com.


### Using URL Shortener API v1
1) Making Swagger Format (JSON)
For google urlshortener open API, you can find at https://github.com/APIs-guru/openapi-directory/tree/master/APIs/googleapis.com/urlshortener/v1
But it is not swagger's json format. For converting yaml to json, I am using https://www.browserling.com/tools/yaml-to-json.
Save the result with `swagger.json`.

2) Generating Client Stub Code
```
(generate-client #p"./swagger.json" "client3.lisp")
```


3) Acquiring and using an API key
Please visit "https://developers.google.com/url-shortener/v1/getting_started" and get API key


4) Calling function from client stub
with api key, we can make request-url 
```
(post-url  "https://www.googleapis.com/urlshortener/v1/url?key=YOURKEYHERE" :content (cl-json:encode-json-to-string '(("longUrl" . "https://www.google.com/"))))

(get-url  "https://www.googleapis.com/urlshortener/v1/url?key=YOURKEYHERE&shortUrl=http://goo.gl/fbsS")

```
